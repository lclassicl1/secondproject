<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="mapper.club">
		<resultMap type="clubDTO" id="clubDTO">
		<result property="cNo" column="cNo"/>
		<result property="cName" column="cName"/>
		<result property="cIntro" column="cIntro"/>
		<result property="masterId" column="masterId"/>
		<result property="cLoc" column="cLoc"/>
		<result property="creDate" column="creDate"/>
		<result property="cPeople" column="cPeople"/>
		<result property="cIsShow" column="cIsShow"/>
		<result property="categoryNo" column="categoryNo"/>
	</resultMap> 
 
 	<!-- 카테고리 조회 -->
 	<select id="selCategoryName" parameterType="int" resultType="String">
 	 <![CDATA[
		select categoryName
		from category
		where categoryNo=#{categoryNo}
 	]]>
 	</select> 	
 	
 	<!-- 클럽리스트 검색 -->
	<select id="searchClub" resultMap="clubDTO" parameterType="clubDTO">
 	<![CDATA[
		select *
		from club
		where 
		     cName like concat ('%',#{cName},'%')	
	  		and categoryNo=#{categoryNo}
			order by cNo desc
  	]]> 	
 	</select>


 	<!-- 클럽 리스트 조회  -->
	<select id="selClubList" parameterType="int" resultType="clubDTO">
 	<![CDATA[
		select *
		from club
		where categoryNo=#{categoryNo}
		order by cNo desc
  	]]>
	</select>  	

 	<!-- 클럽 상세보기-소개글 -->
 	<select id="selClubDetail" parameterType="int" resultType="clubDTO">
 	<![CDATA[
		select *
		from club
		where cNo=#{cNo}
  	]]>
	</select> 
	<!-- 클럽 가입자 수 -->
	<select id="clubCount" parameterType="int" resultType="int">
 	<![CDATA[
		select count(cMemberNo)
		from clubmember
		where cNo=#{cNo}
  	]]>
	</select> 
	<!-- 상세보기-모임글 조회 -->
	<select id="selBoardDetail" parameterType="int" resultType="boardVO">
 	<![CDATA[
	 	select *
	 	from board
	 	where cNo=#{cNo}
	 	and bType='모집'
	 	limit 0, 2
  	]]>
	</select> 
	
	<!--  클럽 가입한 회원리스트 -->
	<select id="clubMemeber" parameterType="int" resultType="com.damoye.secondproject.model.User">
	<![CDATA[
		select u.id
		from user u,clubmember c
		where u.no=c.no
		and c.cNo=#{cNo}
	]]>
	</select>

 	<!-- 클럽가입하기 -->
 	<insert id="signClub" parameterType="clubMemberDTO">
 	<![CDATA[
	 	insert into clubmember(cNo,no)
		values(#{cNo},#{no}) 	 	
 	]]> 	
 	</insert>

 	<!-- 클럽생성하기 -->
 	<insert id="createClub" parameterType="clubDTO">
 	<![CDATA[
		insert into club(cName,cIntro,masterId,categoryNo,cLoc,cPeople)
		values(#{cName},#{cIntro},#{masterId},#{categoryNo},#{cLoc},#{cPeople}) 	
 	]]> 	
 	</insert>
 	
 	<!-- 클럽수정하기  -->
 	<update id="updateClub" parameterType="clubDTO">
 	<![CDATA[
	 	update club
		set cName=#{cName},cIntro=#{cIntro},categoryNo=#{categoryNo},cLoc=#{cLoc},cPeople=#{cPeople}
		where cNo=#{cNo}
 	]]> 
 	</update>
 	
 	<!-- 클럽탈퇴하기 -->
 	<update id="delUpClub" parameterType="clubMemberDTO">
 	<![CDATA[
	 	update clubmember
		set signIn='N'
		where cNo=#{cNo}
		and no=#{no}
 	]]> 
 	</update>
 	
 	<!-- 클럽 삭제하기 /클럽장과 관리자만-->
 	<delete id="clubDel" parameterType="int">
 	<![CDATA[
		delete from club
		where cNo=#{cNo}
 	]]> 
 	</delete>
 	
 
 </mapper>